<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard Links - Professional v6</title>

<!-- SheetJS for Excel Import/Export -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
  :root{
    --primary:#1b75bb;
    --primary-dark:#0f5c94;
    --bg:#f4f8fc;
    --card:#ffffff;
    --border:#dbe7f3;
    --text:#1b2e3c;
    --muted:#6e7c87;
    --radius:12px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;padding:30px;
    font-family:Inter,Segoe UI,Arial;
    background:var(--bg);
    color:var(--text);
  }
  header{
    max-width:1150px;margin:0 auto 22px;
    display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;
  }
  .brand{display:flex;gap:12px;align-items:center}
  .logo{
    width:52px;height:52px;border-radius:12px;
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    display:flex;align-items:center;justify-content:center;
    color:#fff;font-weight:700;font-size:22px;
  }
  .title{font-weight:700;font-size:18px}
  .muted{font-size:12px;color:var(--muted)}
  .left-controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:10px}
  input.search{padding:9px 12px;border-radius:10px;border:1px solid var(--border);width:240px}
  select{padding:9px;border-radius:10px;border:1px solid var(--border)}
  .controls{display:flex;gap:8px}
  button{
    padding:9px 12px;border-radius:10px;
    border:1px solid var(--border);cursor:pointer;
    font-weight:600;background:#fff;color:var(--primary-dark);
  }
  .btn-primary{background:var(--primary);color:#fff;border:0}
  .btn-danger{background:#c0392b;color:#fff;border:0}

  main{max-width:1150px;margin:0 auto;}

  .category-row{
    margin-top:22px;padding:2px;border-radius:12px;
    transition:.12s;background:transparent;
  }
  .category-row.drag-over{background:#e6f3ff}

  .category-header{display:flex;gap:12px;align-items:center}
  .cat-icon{
    width:46px;height:46px;border-radius:10px;
    background:#eaf3fc;display:flex;align-items:center;justify-content:center;
    font-size:20px;
  }
  .cat-title{font-size:18px;font-weight:700}

  .cards{
    display:grid;grid-template-columns:repeat(auto-fill,minmax(235px,1fr));
    gap:12px;margin-top:12px;padding:4px;
  }

  .card{
    background:#fff;border:1px solid var(--border);
    border-radius:12px;padding:14px;min-height:90px;
    box-shadow:0 4px 12px rgba(0,0,0,0.05);
    cursor:grab;user-select:none;transition:.12s;
    display:flex;flex-direction:column;gap:6px;
  }
  .card:hover{transform:translateY(-4px)}
  .card.dragging{opacity:0.5}

  .card-title{font-weight:700}
  .card-url{
    font-size:13px;color:var(--muted);
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }

  /* Add card (show only if category has links) */
  .add-card{
    background:#eef5ff;border:2px dashed var(--primary);
    display:flex;align-items:center;justify-content:center;
    font-size:32px;border-radius:12px;cursor:pointer;
  }

  /* Modal */
  .modal-backdrop{
    position:fixed;inset:0;background:rgba(0,0,0,0.45);
    display:none;align-items:center;justify-content:center;padding:20px;z-index:999;
  }
  .modal{
    background:#fff;padding:18px;border-radius:12px;width:420px;max-width:100%;
  }
  .row{display:flex;justify-content:flex-end;gap:10px;margin-top:14px}
  input,select{margin-top:6px;width:100%;padding:10px;border-radius:8px;border:1px solid var(--border)}

</style>
</head>

<body>

<header>
  <div class="brand">
    <div class="logo">DL</div>
    <div>
      <div class="title">Dashboard Links â€“ v6</div>
      <div class="muted">Professional Edition</div>
    </div>
  </div>

  <div class="left-controls">
    <input class="search" id="searchBox" placeholder="Search links..." />
    <select id="catSort">
      <option value="default">Default order</option>
      <option value="alpha">A â†’ Z</option>
      <option value="alpha-desc">Z â†’ A</option>
      <option value="most">Most links</option>
      <option value="least">Least links</option>
    </select>
  </div>

  <div class="controls">
    <button id="btnAddCategory">+ Add Category</button>
    <button class="btn-primary" id="btnAddLink">+ Add Link</button>
    <button id="btnDelete">ðŸ—‘ Delete</button>
    <button id="btnExport">ðŸ“¤ Export</button>
    <button id="btnImport">ðŸ“¥ Import</button>
  </div>
</header>

<main id="mainArea"></main>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop"><div class="modal" id="modalContent"></div></div>

<script>
/* Storage */
const CATS_KEY="cats_v6";
const LINKS_KEY="links_v6";

let categories = JSON.parse(localStorage.getItem(CATS_KEY)) || [
  {id:"c1",name:"HR"},
  {id:"c2",name:"Production"},
  {id:"c3",name:"Finance"},
  {id:"c4",name:"IT"},
  {id:"c5",name:"Admin"}
];
let links = JSON.parse(localStorage.getItem(LINKS_KEY)) || [];

const save = ()=>{ localStorage.setItem(CATS_KEY,JSON.stringify(categories)); localStorage.setItem(LINKS_KEY,JSON.stringify(links)); };
const uid=()=> "id"+Math.random().toString(36).slice(2);
const icon=cat=>({HR:"ðŸ‘¨â€ðŸ’¼",Production:"ðŸ­",Finance:"ðŸ’°",IT:"ðŸ’»",Admin:"ðŸ¢"}[cat]||"ðŸ”—");

const main=document.getElementById("mainArea");
const search=document.getElementById("searchBox");
const sort=document.getElementById("catSort");

/* Sorting */
function applySort(cats){
  const mode=sort.value;
  if(mode==="alpha") return [...cats].sort((a,b)=>a.name.localeCompare(b.name));
  if(mode==="alpha-desc") return [...cats].sort((a,b)=>b.name.localeCompare(a.name));
  if(mode==="most") return [...cats].sort((a,b)=>links.filter(l=>l.category==b.id).length - links.filter(l=>l.category==a.id).length);
  if(mode==="least") return [...cats].sort((a,b)=>links.filter(l=>l.category==a.id).length - links.filter(l=>l.category==b.id).length);
  return cats;
}

/* Render */
function render(){
  const q=(search.value||"").toLowerCase();
  main.innerHTML="";
  const cats=applySort(categories);

  cats.forEach(cat=>{
    const row=document.createElement("div");
    row.className="category-row";
    row.draggable=true;
    row.dataset.id=cat.id;

    /* Drag category */
    row.addEventListener("dragstart",e=>{
      e.dataTransfer.setData("text/plain",JSON.stringify({type:"cat",id:cat.id}));
      row.style.opacity="0.5";
    });
    row.addEventListener("dragend",()=> row.style.opacity="1");

    /* Drop category */
    row.addEventListener("dragover",e=>{ e.preventDefault(); row.classList.add("drag-over"); });
    row.addEventListener("dragleave",()=> row.classList.remove("drag-over"));
    row.addEventListener("drop",e=>{
      row.classList.remove("drag-over");
      const data=JSON.parse(e.dataTransfer.getData("text/plain")||"{}");
      if(data.type==="cat" && data.id!==cat.id){
        const from=categories.findIndex(c=>c.id===data.id);
        const to=categories.findIndex(c=>c.id===cat.id);
        const moved=categories.splice(from,1)[0];
        categories.splice(to,0,moved);
        save(); render();
      }
    });

    /* Header */
    row.innerHTML=`
      <div class="category-header">
        <div class="cat-icon">${icon(cat.name)}</div>
        <div>
          <div class="cat-title">${cat.name}</div>
          <div class="muted">${links.filter(l=>l.category==cat.id).length} links</div>
        </div>
      </div>
    `;

    const cards=document.createElement("div");
    cards.className="cards";
    cards.dataset.cat=cat.id;

    /* Drop card */
    cards.addEventListener("dragover",e=>{ e.preventDefault(); cards.classList.add("drag-over"); });
    cards.addEventListener("dragleave",()=> cards.classList.remove("drag-over"));
    cards.addEventListener("drop",e=>{
      cards.classList.remove("drag-over");
      const data=JSON.parse(e.dataTransfer.getData("text/plain")||"{}");
      if(data.type==="card"){
        links = links.filter(l=>l.id!==data.id);
        links.push({...data.payload,category:cat.id});
        save(); render();
      }
    });

    /* Cards */
    links.forEach(l=>{
      if(l.category!==cat.id) return;
      if(q && !l.title.toLowerCase().includes(q)) return;

      const cd=document.createElement("div");
      cd.className="card";
      cd.draggable=true;
      cd.innerHTML=`<div class="card-title">${l.title}</div><div class="card-url">${l.url}</div>`;
      cd.addEventListener("click",()=>window.open(l.url,"_blank"));
      cd.addEventListener("dragstart",e=>{
        cd.classList.add("dragging");
        e.dataTransfer.setData("text/plain",JSON.stringify({type:"card",id:l.id,payload:l}));
      });
      cd.addEventListener("dragend",()=> cd.classList.remove("dragging"));
      cards.appendChild(cd);
    });

    /* Add-card â†’ show only if category has links */
    const hasLinks = links.some(l=>l.category===cat.id);
    if(hasLinks){
      const add=document.createElement("div");
      add.className="card add-card";
      add.textContent="+";
      add.onclick=()=>openAddLink(cat.id);
      cards.appendChild(add);
    }

    row.appendChild(cards);
    main.appendChild(row);
  });
}

/* Modal helpers */
const overlay=document.getElementById("modalBackdrop");
const modal=document.getElementById("modalContent");
const openModal=html=>{modal.innerHTML=html;overlay.style.display="flex";};
const closeModal=()=>{overlay.style.display="none";modal.innerHTML="";};
overlay.onclick=e=>{if(e.target===overlay) closeModal()};

/* Add Category */
btnAddCategory.onclick=()=>{
  openModal(`
    <h3>Add Category</h3>
    <input id="catName" placeholder="Category name" />
    <div class="row"><button class="btn-primary" id="saveCat">Save</button></div>
  `);
  saveCat.onclick=()=>{
    const name=catName.value.trim();
    if(!name) return alert("Enter name");
    categories.push({id:uid(),name});
    save(); closeModal(); render();
  };
};

/* Add Link */
function openAddLink(catId){
  const opts=categories.map(c=>`<option value="${c.id}" ${c.id===catId?"selected":""}>${c.name}</option>`).join("");
  openModal(`
    <h3>Add Link</h3>
    <input id="lTitle" placeholder="Title" />
    <input id="lUrl" placeholder="https://example.com" />
    <select id="lCat">${opts}</select>
    <div class="row"><button class="btn-primary" id="saveLink">Save</button></div>
  `);
  saveLink.onclick=()=>{
    const t=lTitle.value.trim();
    const u=lUrl.value.trim();
    if(!t||!u) return alert("Missing fields");
    links.push({id:uid(),title:t,url:u,category:lCat.value});
    save(); closeModal(); render();
  };
}
btnAddLink.onclick=()=>openAddLink(categories[0].id);

/* Delete */
btnDelete.onclick=()=>{
  const cOps=categories.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");
  const lOps=links.map(l=>`<option value="${l.id}">${l.title}</option>`).join("");
  openModal(`
    <h3>Delete</h3>
    <label><input type="radio" name="typ" value="cat" checked> Category</label><br>
    <label><input type="radio" name="typ" value="link"> Link</label>
    <div id="delWrap" style="margin-top:10px"><select id="delVal">${cOps}</select></div>
    <div class="row"><button class="btn-danger" id="doDelete">Delete</button></div>
  `);
  document.querySelectorAll("input[name=typ]").forEach(r=>r.onchange=()=>{
    delWrap.innerHTML = r.value==="cat"
      ? `<select id="delVal">${cOps}</select>`
      : `<select id="delVal">${lOps}</select>`;
  });
  doDelete.onclick=()=>{
    const t=document.querySelector("input[name=typ]:checked").value;
    const id=delVal.value;
    if(t==="cat"){
      if(links.some(l=>l.category==id)) return alert("Category not empty");
      categories=categories.filter(c=>c.id!==id);
    } else {
      links=links.filter(l=>l.id!==id);
    }
    save(); closeModal(); render();
  }
};

/* Export */
btnExport.onclick=()=>{
  const data=links.map(l=>({
    Category:categories.find(c=>c.id===l.category)?.name,
    Title:l.title,
    URL:l.url
  }));
  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Links");
  XLSX.writeFile(wb,"DashboardLinks.xlsx");
};

/* Import */
btnImport.onclick=()=>{
  openModal(`
    <h3>Import Excel/CSV</h3>
    <input id="imp" type="file" accept=".csv,.xlsx" />
    <div class="row"><button class="btn-primary" id="doImp">Import</button></div>
  `);
  doImp.onclick=()=>{
    const f=imp.files[0];
    if(!f) return alert("Select file");
    const rd=new FileReader();
    rd.onload=e=>{
      const wb=XLSX.read(e.target.result,{type:"binary"});
      const ws=wb.Sheets[wb.SheetNames[0]];
      const rows=XLSX.utils.sheet_to_json(ws);

      links=[];
      rows.forEach(r=>{
        const cname=(r.Category||"").trim();
        if(!cname) return;
        let cat=categories.find(c=>c.name.toLowerCase()===cname.toLowerCase());
        if(!cat){
          cat={id:uid(),name:cname}; categories.push(cat);
        }
        links.push({
          id:uid(), title:r.Title||"", url:r.URL||"", category:cat.id
        });
      });

      save(); closeModal(); render();
    };
    rd.readAsBinaryString(f);
  };
};

/* Events */
search.oninput=render;
sort.onchange=render;

/* Start */
render();
</script>

</body>
</html>
